const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/observers-DByOVZnt.js","assets/ErrorBoundary-Db3fel1P.js","assets/chunk-D4RADZKF-BRHePM6R.js","assets/Text-D6C5v_cM.js","assets/index-DLedCYB8.js","assets/fetch-CUNrtEpB.js"])))=>i.map(i=>d[i]);
import{aw as _,az as C,aA as w,av as z,aC as rt,ay as Y,ax as ue,_ as Oe}from"./ErrorBoundary-Db3fel1P.js";import{g as X,F as nr,L as Ge,d as ir,C as or,B as sr,S as ut,a as ar,r as lt,b as cr,f as fe}from"./fetch-CUNrtEpB.js";import"./chunk-D4RADZKF-BRHePM6R.js";import"./Text-D6C5v_cM.js";import"./index-DLedCYB8.js";var Ee;(function(t){t.US="US",t.EU="EU",t.STAGING="STAGING"})(Ee||(Ee={}));var xt="[Amplitude]",ur="".concat(xt," Session Replay ID"),lr=0,dr=Ee.US,fr="".concat(xt," Session Replay Debug"),vr="amp-block",At="amp-mask",hr="amp-unmask",gr="https://api-sr.amplitude.com/sessions/v2/track",pr="https://api-sr.eu.amplitude.com/sessions/v2/track",mr="https://api-sr.stag2.amplitude.com/sessions/v2/track",yr=1*1e6,Sr=3e4,br=6e4,Er=500,wr=10*1e3,qt=1024,Ir=1e3,ae;(function(t){t.GET_SR_PROPS="get-sr-props",t.DEBUG_INFO="debug-info",t.FETCH_REQUEST="fetch-request",t.METADATA="metadata"})(ae||(ae={}));var We=function(){function t(e){this.logger=e,this.log=this.getSafeMethod("log"),this.warn=this.getSafeMethod("warn"),this.error=this.getSafeMethod("error"),this.debug=this.getSafeMethod("debug")}return t.prototype.getSafeMethod=function(e){var r;if(!this.logger)return function(){};var n=this.logger[e];if(typeof n=="function"){var i=(r=n.__rrweb_original__)!==null&&r!==void 0?r:n;return i.bind(this.logger)}return function(){}},t.prototype.enable=function(e){this.logger.enable(e)},t.prototype.disable=function(){this.logger.disable()},t}(),ze="medium";function Cr(t){return t.toLowerCase()}function Rr(t){var e=t.type;return t.hasAttribute("data-rr-is-password")?"password":e?Cr(e):null}var Nt=function(t,e,r){switch(e){case"light":{if(t!=="input")return!0;var n=r?Rr(r):"";return n?!!(["password","hidden","email","tel"].includes(n)||r.autocomplete.startsWith("cc-")):!1}case"medium":case"conservative":return!0;default:return Nt(t,ze,r)}},Pr=function(t,e,r){var n,i,o;if(e===void 0&&(e={defaultMaskLevel:ze}),r){if(r.closest("."+At))return!0;var s=((n=e.maskSelector)!==null&&n!==void 0?n:[]).some(function(a){return r.closest(a)});if(s)return!0;if(r.closest("."+hr))return!1;var c=((i=e.unmaskSelector)!==null&&i!==void 0?i:[]).some(function(a){return r.closest(a)});if(c)return!1}return Nt(t,(o=e.defaultMaskLevel)!==null&&o!==void 0?o:ze,r)},dt=function(t,e){return function(r,n){return Pr(t,e,n)?r.replace(/[^\s]/g,"*"):r}},je=function(t){var e=0;if(t.length===0)return e;for(var r=0;r<t.length;r++){var n=t.charCodeAt(r);e=(e<<5)-e+n,e|=0}return e},_r=function(t,e){var r=je(t.toString()),n=Math.abs(r),i=n*31,o=i%1e6;return o/1e6<e},Tr=function(){var t=X();return t!=null&&t.location?t.location.href:""},kr=function(t,e){return"".concat(e,"/").concat(t)},Ut=function(t,e){return e||(t===Ee.STAGING?mr:t===Ee.EU?pr:gr)},Lr=function(t){if(typeof t!="string"||t.trim()==="")return!1;var e=/^\/|^https?:\/\/[^\s]+$/;return!!e.test(t)},Mr=function(t){var e=t.replace(/[.+^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*").replace(/\?/g,".");return new RegExp("^".concat(e,"$"))},Dr=function(t){if(!t.every(function(e){return typeof e.selector=="string"&&typeof e.replacement=="string"}))throw new Error("ugcFilterRules must be an array of objects with selector and replacement properties");if(!t.every(function(e){return Lr(e.selector)}))throw new Error("ugcFilterRules must be an array of objects with valid globs")},nt=function(t,e){var r,n;try{for(var i=z(e),o=i.next();!o.done;o=i.next()){var s=o.value,c=Mr(s.selector);if(c.test(t))return t.replace(c,s.replacement)}}catch(a){r={error:a}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return t},Ft=function(){return C(void 0,void 0,void 0,function(){var t,e,r,n,i,o,s;return w(this,function(c){switch(c.label){case 0:return c.trys.push([0,3,,4]),t=X(),t?[4,t.navigator.storage.estimate()]:[3,2];case 1:return e=c.sent(),r=e.usage,n=e.quota,i=e.usageDetails,o=r?Math.round(r/qt):0,s=r&&n?Math.round((r/n+Number.EPSILON)*1e3)/1e3:0,[2,{totalStorageSize:o,percentOfQuota:s,usageDetails:JSON.stringify(i)}];case 2:return[3,4];case 3:return c.sent(),[3,4];case 4:return[2,{totalStorageSize:0,percentOfQuota:0,usageDetails:""}]}})})},Bt=function(t){var e=_({},t),r=e.apiKey;return e.apiKey="****".concat(r.substring(r.length-4)),e},Kt=function(){return{flushMaxRetries:2,logLevel:ir.Warn,loggerProvider:new Ge,transportProvider:new nr}},Or=function(t){rt(e,t);function e(r,n){var i=this,o,s,c=Kt();return i=t.call(this,_(_({transportProvider:c.transportProvider,loggerProvider:new We(n.loggerProvider||c.loggerProvider)},n),{apiKey:r}))||this,i.flushMaxRetries=n.flushMaxRetries!==void 0&&n.flushMaxRetries<=c.flushMaxRetries?n.flushMaxRetries:c.flushMaxRetries,i.apiKey=r,i.sampleRate=n.sampleRate||lr,i.serverZone=n.serverZone||dr,i.configServerUrl=n.configServerUrl,i.trackServerUrl=n.trackServerUrl,i.shouldInlineStylesheet=n.shouldInlineStylesheet,i.version=n.version,i.performanceConfig=n.performanceConfig,i.storeType=(o=n.storeType)!==null&&o!==void 0?o:"idb",i.applyBackgroundColorToBlockedElements=(s=n.applyBackgroundColorToBlockedElements)!==null&&s!==void 0?s:!1,n.privacyConfig&&(i.privacyConfig=n.privacyConfig),n.interactionConfig&&(i.interactionConfig=n.interactionConfig,i.interactionConfig.ugcFilterRules&&Dr(i.interactionConfig.ugcFilterRules)),n.debugMode&&(i.debugMode=n.debugMode),n.experimental&&(i.experimental=n.experimental),i}return e}(or),Gt=(t=>(t[t.DomContentLoaded=0]="DomContentLoaded",t[t.Load=1]="Load",t[t.FullSnapshot=2]="FullSnapshot",t[t.IncrementalSnapshot=3]="IncrementalSnapshot",t[t.Meta=4]="Meta",t[t.Custom=5]="Custom",t[t.Plugin=6]="Plugin",t))(Gt||{}),Wt=(t=>(t[t.MouseUp=0]="MouseUp",t[t.MouseDown=1]="MouseDown",t[t.Click=2]="Click",t[t.ContextMenu=3]="ContextMenu",t[t.DblClick=4]="DblClick",t[t.Focus=5]="Focus",t[t.Blur=6]="Blur",t[t.TouchStart=7]="TouchStart",t[t.TouchMove_Departed=8]="TouchMove_Departed",t[t.TouchEnd=9]="TouchEnd",t[t.TouchCancel=10]="TouchCancel",t))(Wt||{}),_e;(function(t){t.US="US",t.EU="EU",t.STAGING="STAGING"})(_e||(_e={}));var x;(function(t){t.Unknown="unknown",t.Skipped="skipped",t.Success="success",t.RateLimit="rate_limit",t.PayloadTooLarge="payload_too_large",t.Invalid="invalid",t.Failed="failed",t.Timeout="Timeout",t.SystemError="SystemError"})(x||(x={}));var xr=function(){function t(){}return t.prototype.send=function(e,r){return Promise.resolve(null)},t.prototype.buildResponse=function(e){var r,n,i,o,s,c,a,l,u,m,d,f,g,h,b,P,v,p,I,E,R,y;if(typeof e!="object")return null;var S=e.code||0,T=this.buildStatus(S);switch(T){case x.Success:return{status:T,statusCode:S,body:{eventsIngested:(r=e.events_ingested)!==null&&r!==void 0?r:0,payloadSizeBytes:(n=e.payload_size_bytes)!==null&&n!==void 0?n:0,serverUploadTime:(i=e.server_upload_time)!==null&&i!==void 0?i:0}};case x.Invalid:return{status:T,statusCode:S,body:{error:(o=e.error)!==null&&o!==void 0?o:"",missingField:(s=e.missing_field)!==null&&s!==void 0?s:"",eventsWithInvalidFields:(c=e.events_with_invalid_fields)!==null&&c!==void 0?c:{},eventsWithMissingFields:(a=e.events_with_missing_fields)!==null&&a!==void 0?a:{},eventsWithInvalidIdLengths:(l=e.events_with_invalid_id_lengths)!==null&&l!==void 0?l:{},epsThreshold:(u=e.eps_threshold)!==null&&u!==void 0?u:0,exceededDailyQuotaDevices:(m=e.exceeded_daily_quota_devices)!==null&&m!==void 0?m:{},silencedDevices:(d=e.silenced_devices)!==null&&d!==void 0?d:[],silencedEvents:(f=e.silenced_events)!==null&&f!==void 0?f:[],throttledDevices:(g=e.throttled_devices)!==null&&g!==void 0?g:{},throttledEvents:(h=e.throttled_events)!==null&&h!==void 0?h:[]}};case x.PayloadTooLarge:return{status:T,statusCode:S,body:{error:(b=e.error)!==null&&b!==void 0?b:""}};case x.RateLimit:return{status:T,statusCode:S,body:{error:(P=e.error)!==null&&P!==void 0?P:"",epsThreshold:(v=e.eps_threshold)!==null&&v!==void 0?v:0,throttledDevices:(p=e.throttled_devices)!==null&&p!==void 0?p:{},throttledUsers:(I=e.throttled_users)!==null&&I!==void 0?I:{},exceededDailyQuotaDevices:(E=e.exceeded_daily_quota_devices)!==null&&E!==void 0?E:{},exceededDailyQuotaUsers:(R=e.exceeded_daily_quota_users)!==null&&R!==void 0?R:{},throttledEvents:(y=e.throttled_events)!==null&&y!==void 0?y:[]}};case x.Timeout:default:return{status:T,statusCode:S}}},t.prototype.buildStatus=function(e){return e>=200&&e<300?x.Success:e===429?x.RateLimit:e===413?x.PayloadTooLarge:e===408?x.Timeout:e>=400&&e<500?x.Invalid:e>=500?x.Failed:x.Unknown},t}(),Ar="Network error occurred, remote config fetch failed",qr="Remote config successfully fetched",Nr="Remote config fetch rejected due to exceeded retry count",ft="Remote config fetch rejected due to timeout after 5 seconds",vt="Unexpected error occurred",Ur="https://sr-client-cfg.amplitude.com/config",Fr="https://sr-client-cfg.stag2.amplitude.com/config",Br="https://sr-client-cfg.eu.amplitude.com/config",Kr=function(){function t(e){var r=e.localConfig,n=e.configKeys,i=this;this.retryTimeout=1e3,this.attempts=0,this.sessionTargetingMatch=!1,this.metrics={},this.getRemoteConfig=function(o,s,c){return C(i,void 0,void 0,function(){var a,l,u;return w(this,function(m){switch(m.label){case 0:return a=Date.now(),[4,this.fetchWithTimeout(c)];case 1:return l=m.sent(),l&&(u=l.configs&&l.configs[o],u)?(this.metrics.fetchTimeAPISuccess=Date.now()-a,[2,u[s]]):(this.metrics.fetchTimeAPIFail=Date.now()-a,[2,void 0])}})})},this.fetchWithTimeout=function(o){return C(i,void 0,void 0,function(){var s,c,a;return w(this,function(l){switch(l.label){case 0:return s=new AbortController,c=setTimeout(function(){return s.abort()},5e3),[4,this.fetchRemoteConfig(s.signal,o)];case 1:return a=l.sent(),clearTimeout(c),[2,a]}})})},this.fetchRemoteConfig=function(o,s){return C(i,void 0,void 0,function(){var c,a,l,u,m,d,f,g,h,b,P,v,p;return w(this,function(I){switch(I.label){case 0:if(s===this.lastFetchedSessionId&&this.attempts>=this.localConfig.flushMaxRetries)return[2,this.completeRequest({err:Nr})];if(o.aborted)return[2,this.completeRequest({err:ft})];s!==this.lastFetchedSessionId&&(this.lastFetchedSessionId=s,this.attempts=0),I.label=1;case 1:I.trys.push([1,3,,4]),c=new URLSearchParams({api_key:this.localConfig.apiKey});try{for(a=z(this.configKeys),l=a.next();!l.done;l=a.next())u=l.value,c.append("config_keys",u)}catch(E){P={error:E}}finally{try{l&&!l.done&&(v=a.return)&&v.call(a)}finally{if(P)throw P.error}}return s&&c.set("session_id",String(s)),m={headers:{Accept:"*/*"},method:"GET"},d="".concat(this.getServerUrl(),"?").concat(c.toString()),this.attempts+=1,[4,fetch(d,_(_({},m),{signal:o}))];case 2:if(f=I.sent(),f===null)return[2,this.completeRequest({err:vt})];switch(g=new xr().buildStatus(f.status),g){case x.Success:return this.attempts=0,[2,this.parseAndStoreConfig(f)];case x.Failed:return[2,this.retryFetch(o,s)];default:return[2,this.completeRequest({err:Ar})]}case 3:return h=I.sent(),b=h,o.aborted?[2,this.completeRequest({err:ft})]:[2,this.completeRequest({err:(p=b.message)!==null&&p!==void 0?p:vt})];case 4:return[2]}})})},this.retryFetch=function(o,s){return C(i,void 0,void 0,function(){var c=this;return w(this,function(a){switch(a.label){case 0:return[4,new Promise(function(l){return setTimeout(l,c.attempts*c.retryTimeout)})];case 1:return a.sent(),[2,this.fetchRemoteConfig(o,s)]}})})},this.parseAndStoreConfig=function(o){return C(i,void 0,void 0,function(){var s;return w(this,function(c){switch(c.label){case 0:return[4,o.json()];case 1:return s=c.sent(),this.completeRequest({success:qr}),[2,s]}})})},this.localConfig=r,this.configKeys=n}return t.prototype.getServerUrl=function(){return this.localConfig.configServerUrl?this.localConfig.configServerUrl:this.localConfig.serverZone===_e.STAGING?Fr:this.localConfig.serverZone===_e.EU?Br:Ur},t.prototype.completeRequest=function(e){var r=e.err,n=e.success;if(r)throw new Error(r);n&&this.localConfig.loggerProvider.log(n)},t}(),Gr=function(t){var e=t.localConfig,r=t.configKeys;return C(void 0,void 0,void 0,function(){return w(this,function(n){return[2,new Kr({localConfig:e,configKeys:r})]})})},Wr=Gr,zr=function(t,e){var r=document.createDocumentFragment(),n=function(i){if(i===void 0&&(i=[]),typeof i=="string"&&(i=[i]),i=i.filter(function(o){try{r.querySelector(o)}catch{return e.warn('[session-replay-browser] omitting selector "'.concat(o,'" because it is invalid')),!1}return!0}),i.length!==0)return i};return t.blockSelector=n(t.blockSelector),t.maskSelector=n(t.maskSelector),t.unmaskSelector=n(t.unmaskSelector),t},jr=function(){function t(e,r){this.localConfig=r,this.remoteConfigFetch=e}return t.prototype.generateJoinedConfig=function(e){var r,n,i,o;return C(this,void 0,void 0,function(){var s,c,a,l,u,m,d,f,g,h,b,P,v,p,I,E,R,y,S,T,M,W;return w(this,function(L){switch(L.label){case 0:s=_({},this.localConfig),s.optOut=this.localConfig.optOut,s.captureEnabled=!0,L.label=1;case 1:return L.trys.push([1,6,,7]),[4,this.remoteConfigFetch.getRemoteConfig("sessionReplay","sr_sampling_config",e)];case 2:return a=L.sent(),[4,this.remoteConfigFetch.getRemoteConfig("sessionReplay","sr_privacy_config",e)];case 3:return l=L.sent(),u=(r=s.interactionConfig)===null||r===void 0?void 0:r.ugcFilterRules,m=s,[4,this.remoteConfigFetch.getRemoteConfig("sessionReplay","sr_interaction_config",e)];case 4:return m.interactionConfig=L.sent(),s.interactionConfig&&u&&(s.interactionConfig.ugcFilterRules=u),d=s,[4,this.remoteConfigFetch.getRemoteConfig("sessionReplay","sr_logging_config",e)];case 5:return d.loggingConfig=L.sent(),(a||l)&&(c={},a&&(c.sr_sampling_config=a),l&&(c.sr_privacy_config=l)),[3,7];case 6:return f=L.sent(),g=f,this.localConfig.loggerProvider.warn(g.message),s.captureEnabled=!1,[3,7];case 7:if(!c)return[2,{localConfig:this.localConfig,joinedConfig:s,remoteConfig:c}];if(h=c.sr_sampling_config,b=c.sr_privacy_config,h&&Object.keys(h).length>0?(Object.prototype.hasOwnProperty.call(h,"capture_enabled")?s.captureEnabled=h.capture_enabled:s.captureEnabled=!1,Object.prototype.hasOwnProperty.call(h,"sample_rate")&&(s.sampleRate=h.sample_rate)):(s.captureEnabled=!0,this.localConfig.loggerProvider.debug("Remote config successfully fetched, but no values set for project, Session Replay capture enabled.")),b){P=(n=s.privacyConfig)!==null&&n!==void 0?n:{},v={defaultMaskLevel:(o=(i=b.defaultMaskLevel)!==null&&i!==void 0?i:P.defaultMaskLevel)!==null&&o!==void 0?o:"medium",blockSelector:[],maskSelector:[],unmaskSelector:[]},p=function(A){var q,B,K,D,N,H,ie,G,$,Q={};typeof A.blockSelector=="string"&&(A.blockSelector=[A.blockSelector]);try{for(var U=z((ie=A.blockSelector)!==null&&ie!==void 0?ie:[]),O=U.next();!O.done;O=U.next()){var oe=O.value;Q[oe]="block"}}catch(te){q={error:te}}finally{try{O&&!O.done&&(B=U.return)&&B.call(U)}finally{if(q)throw q.error}}try{for(var se=z((G=A.maskSelector)!==null&&G!==void 0?G:[]),Z=se.next();!Z.done;Z=se.next()){var oe=Z.value;Q[oe]="mask"}}catch(te){K={error:te}}finally{try{Z&&!Z.done&&(D=se.return)&&D.call(se)}finally{if(K)throw K.error}}try{for(var de=z(($=A.unmaskSelector)!==null&&$!==void 0?$:[]),ee=de.next();!ee.done;ee=de.next()){var oe=ee.value;Q[oe]="unmask"}}catch(te){N={error:te}}finally{try{ee&&!ee.done&&(H=de.return)&&H.call(de)}finally{if(N)throw N.error}}return Q},I=_(_({},p(P)),p(b));try{for(E=z(Object.entries(I)),R=E.next();!R.done;R=E.next())y=Y(R.value,2),S=y[0],T=y[1],T==="mask"?v.maskSelector.push(S):T==="block"?v.blockSelector.push(S):T==="unmask"&&v.unmaskSelector.push(S)}catch(A){M={error:A}}finally{try{R&&!R.done&&(W=E.return)&&W.call(E)}finally{if(M)throw M.error}}s.privacyConfig=zr(v,this.localConfig.loggerProvider)}return this.localConfig.loggerProvider.debug(JSON.stringify({name:"session replay joined config",config:Bt(s)},null,2)),[2,{localConfig:this.localConfig,joinedConfig:s,remoteConfig:c}]}})})},t}(),Vr=function(t,e){return C(void 0,void 0,void 0,function(){var r,n;return w(this,function(i){switch(i.label){case 0:return r=new Or(t,e),[4,Wr({localConfig:r,configKeys:["sessionReplay"]})];case 1:return n=i.sent(),[2,new jr(n,r)]}})})},Xr="Unexpected error occurred",Hr="Network error occurred, event batch rejected",Qr="Session replay event batch rejected due to exceeded retry count",ve="Failed to store session replay events in IndexedDB",Yr="Session replay event batch not sent due to missing device ID",$r="Session replay event batch not sent due to missing api key",Ve="1.25.2",Zr=function(){function t(e){var r=e.trackServerUrl,n=e.loggerProvider,i=e.payloadBatcher;this.storageKey="",this.retryTimeout=1e3,this.scheduled=null,this.queue=[],this.loggerProvider=n,this.payloadBatcher=i||function(o){return o},this.trackServerUrl=r}return t.prototype.sendEventsList=function(e){this.addToQueue(_(_({},e),{attempts:0,timeout:0}))},t.prototype.addToQueue=function(){for(var e=this,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=r.filter(function(o){return o.attempts<(o.flushMaxRetries||0)?(o.attempts+=1,!0):(e.completeRequest({context:o,err:Qr}),!1)});i.forEach(function(o){if(e.queue=e.queue.concat(o),o.timeout===0){e.schedule(0);return}setTimeout(function(){o.timeout=0,e.schedule(0)},o.timeout)})},t.prototype.schedule=function(e){var r=this;this.scheduled||(this.scheduled=setTimeout(function(){r.flush(!0).then(function(){r.queue.length>0&&r.schedule(e)})},e))},t.prototype.flush=function(e){return e===void 0&&(e=!1),C(this,void 0,void 0,function(){var r,n,i=this;return w(this,function(o){switch(o.label){case 0:return r=[],n=[],this.queue.forEach(function(s){return s.timeout===0?r.push(s):n.push(s)}),this.queue=n,this.scheduled&&(clearTimeout(this.scheduled),this.scheduled=null),[4,Promise.all(r.map(function(s){return i.send(s,e)}))];case 1:return o.sent(),[2]}})})},t.prototype.send=function(e,r){var n,i;return r===void 0&&(r=!0),C(this,void 0,void 0,function(){var o,s,c,a,l,u,m,d,f,g,h,b,P;return w(this,function(v){switch(v.label){case 0:if(o=e.apiKey,!o)return[2,this.completeRequest({context:e,err:$r})];if(s=e.deviceId,!s)return[2,this.completeRequest({context:e,err:Yr})];if(c=Tr(),a=Ve,l=e.sampleRate,u=new URLSearchParams({device_id:s,session_id:"".concat(e.sessionId),type:"".concat(e.type)}),m="".concat(((n=e.version)===null||n===void 0?void 0:n.type)||"standalone","/").concat(((i=e.version)===null||i===void 0?void 0:i.version)||a),d=this.payloadBatcher({version:1,events:e.events}),d.events.length===0)return this.completeRequest({context:e}),[2];v.label=1;case 1:return v.trys.push([1,3,,4]),f={headers:{"Content-Type":"application/json",Accept:"*/*",Authorization:"Bearer ".concat(o),"X-Client-Version":a,"X-Client-Library":m,"X-Client-Url":c.substring(0,Ir),"X-Client-Sample-Rate":"".concat(l)},body:JSON.stringify(d),method:"POST"},g="".concat(Ut(e.serverZone,this.trackServerUrl),"?").concat(u.toString()),[4,fetch(g,f)];case 2:if(h=v.sent(),h===null)return this.completeRequest({context:e,err:Xr}),[2];if(r)this.handleReponse(h.status,e);else{b="";try{b=JSON.stringify(h.body,null,2)}catch{}this.completeRequest({context:e,success:"".concat(h.status,": ").concat(b)})}return[3,4];case 3:return P=v.sent(),this.completeRequest({context:e,err:P}),[3,4];case 4:return[2]}})})},t.prototype.handleReponse=function(e,r){var n=new sr().buildStatus(e);switch(n){case ut.Success:this.handleSuccessResponse(r);break;case ut.Failed:this.handleOtherResponse(r);break;default:this.completeRequest({context:r,err:Hr})}},t.prototype.handleSuccessResponse=function(e){var r=Math.round(new Blob(e.events).size/qt);this.completeRequest({context:e,success:"Session replay event batch tracked successfully for session id ".concat(e.sessionId,", size of events: ").concat(r," KB")})},t.prototype.handleOtherResponse=function(e){this.addToQueue(_(_({},e),{timeout:e.attempts*this.retryTimeout}))},t.prototype.completeRequest=function(e){var r=e.context,n=e.err,i=e.success;r.onComplete(),n?this.loggerProvider.warn(n):i&&this.loggerProvider.log(i)},t}();const Xe=(t,e)=>e.some(r=>t instanceof r);let ht,gt;function Jr(){return ht||(ht=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function en(){return gt||(gt=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const He=new WeakMap,xe=new WeakMap,Le=new WeakMap;function tn(t){const e=new Promise((r,n)=>{const i=()=>{t.removeEventListener("success",o),t.removeEventListener("error",s)},o=()=>{r(ce(t.result)),i()},s=()=>{n(t.error),i()};t.addEventListener("success",o),t.addEventListener("error",s)});return Le.set(e,t),e}function rn(t){if(He.has(t))return;const e=new Promise((r,n)=>{const i=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",s),t.removeEventListener("abort",s)},o=()=>{r(),i()},s=()=>{n(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",o),t.addEventListener("error",s),t.addEventListener("abort",s)});He.set(t,e)}let Qe={get(t,e,r){if(t instanceof IDBTransaction){if(e==="done")return He.get(t);if(e==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return ce(t[e])},set(t,e,r){return t[e]=r,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function zt(t){Qe=t(Qe)}function nn(t){return en().includes(t)?function(...e){return t.apply(Ye(this),e),ce(this.request)}:function(...e){return ce(t.apply(Ye(this),e))}}function on(t){return typeof t=="function"?nn(t):(t instanceof IDBTransaction&&rn(t),Xe(t,Jr())?new Proxy(t,Qe):t)}function ce(t){if(t instanceof IDBRequest)return tn(t);if(xe.has(t))return xe.get(t);const e=on(t);return e!==t&&(xe.set(t,e),Le.set(e,t)),e}const Ye=t=>Le.get(t);function sn(t,e,{blocked:r,upgrade:n,blocking:i,terminated:o}={}){const s=indexedDB.open(t,e),c=ce(s);return n&&s.addEventListener("upgradeneeded",a=>{n(ce(s.result),a.oldVersion,a.newVersion,ce(s.transaction),a)}),r&&s.addEventListener("blocked",a=>r(a.oldVersion,a.newVersion,a)),c.then(a=>{o&&a.addEventListener("close",()=>o()),i&&a.addEventListener("versionchange",l=>i(l.oldVersion,l.newVersion,l))}).catch(()=>{}),c}const an=["get","getKey","getAll","getAllKeys","count"],cn=["put","add","delete","clear"],Ae=new Map;function pt(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Ae.get(e))return Ae.get(e);const r=e.replace(/FromIndex$/,""),n=e!==r,i=cn.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(i||an.includes(r)))return;const o=async function(s,...c){const a=this.transaction(s,i?"readwrite":"readonly");let l=a.store;return n&&(l=l.index(c.shift())),(await Promise.all([l[r](...c),i&&a.done]))[0]};return Ae.set(e,o),o}zt(t=>({...t,get:(e,r,n)=>pt(e,r)||t.get(e,r,n),has:(e,r)=>!!pt(e,r)||t.has(e,r)}));const un=["continue","continuePrimaryKey","advance"],mt={},$e=new WeakMap,jt=new WeakMap,ln={get(t,e){if(!un.includes(e))return t[e];let r=mt[e];return r||(r=mt[e]=function(...n){$e.set(this,jt.get(this)[e](...n))}),r}};async function*dn(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;e=e;const r=new Proxy(e,ln);for(jt.set(r,e),Le.set(r,Ye(e));e;)yield r,e=await($e.get(r)||e.continue()),$e.delete(r)}function yt(t,e){return e===Symbol.asyncIterator&&Xe(t,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&Xe(t,[IDBIndex,IDBObjectStore])}zt(t=>({...t,get(e,r,n){return yt(e,r)?dn:t.get(e,r,n)},has(e,r){return yt(e,r)||t.has(e,r)}}));var Vt=function(){function t(e){var r=this,n,i,o;this.minInterval=Er,this.maxInterval=wr,this.maxPersistedEventsSize=yr,this.interval=this.minInterval,this._timeAtLastSplit=Date.now(),this.shouldSplitEventsList=function(s,c){var a=new Blob([c]).size,l=new Blob(s).size;return l+a>=r.maxPersistedEventsSize?!0:Date.now()-r.timeAtLastSplit>r.interval&&s.length?(r.interval=Math.min(r.maxInterval,r.interval+r.minInterval),r._timeAtLastSplit=Date.now(),!0):!1},this.loggerProvider=e.loggerProvider,this.minInterval=(n=e.minInterval)!==null&&n!==void 0?n:this.minInterval,this.maxInterval=(i=e.maxInterval)!==null&&i!==void 0?i:this.maxInterval,this.maxPersistedEventsSize=(o=e.maxPersistedEventsSize)!==null&&o!==void 0?o:this.maxPersistedEventsSize}return Object.defineProperty(t.prototype,"timeAtLastSplit",{get:function(){return this._timeAtLastSplit},enumerable:!1,configurable:!0}),t}(),Te;(function(t){t.RECORDING="recording",t.SENT="sent"})(Te||(Te={}));var ye="sessionCurrentSequence",Se="sequencesToSend",fn=function(){var t=X();return new Promise(function(e,r){if(!t)return r(new Error("Global scope not found"));if(!t.indexedDB)return r(new Error("Session Replay: cannot find indexedDB"));try{var n=t.indexedDB.open("keyval-store");n.onupgradeneeded=function(){n.result.version===1&&(n.result.close(),n.transaction&&n.transaction.abort(),t.indexedDB.deleteDatabase("keyval-store"),e())},n.onsuccess=function(){e(n.result)},n.onerror=function(){r(n.error)}}catch(i){r(i)}})},St=function(t){return C(void 0,void 0,void 0,function(){var e,r;return w(this,function(n){switch(n.label){case 0:return t.length>0?(e=10,r=t.splice(0,e),[4,Promise.all(r)]):[3,2];case 1:return n.sent(),[3,0];case 2:return[2]}})})},vn=function(t){var e,r;return t.objectStoreNames.contains(ye)||(r=t.createObjectStore(ye,{keyPath:"sessionId"})),t.objectStoreNames.contains(Se)||(e=t.createObjectStore(Se,{keyPath:"sequenceId",autoIncrement:!0}),e.createIndex("sessionId","sessionId")),{sequencesStore:e,currentSequenceStore:r}},hn=function(t){return C(void 0,void 0,void 0,function(){return w(this,function(e){switch(e.label){case 0:return[4,sn(t,1,{upgrade:vn})];case 1:return[2,e.sent()]}})})},gn=function(t){rt(e,t);function e(r){var n=t.call(this,r)||this;return n.getSequencesToSend=function(){return C(n,void 0,void 0,function(){var i,o,s,c,a,l;return w(this,function(u){switch(u.label){case 0:return u.trys.push([0,5,,6]),i=[],[4,this.db.transaction("sequencesToSend").store.openCursor()];case 1:o=u.sent(),u.label=2;case 2:return o?(s=o.value,c=s.sessionId,a=s.events,i.push({events:a,sequenceId:o.key,sessionId:c}),[4,o.continue()]):[3,4];case 3:return o=u.sent(),[3,2];case 4:return[2,i];case 5:return l=u.sent(),this.loggerProvider.warn("".concat(ve,": ").concat(l)),[3,6];case 6:return[2,void 0]}})})},n.storeCurrentSequence=function(i){return C(n,void 0,void 0,function(){var o,s,c;return w(this,function(a){switch(a.label){case 0:return a.trys.push([0,4,,5]),[4,this.db.get(ye,i)];case 1:return o=a.sent(),o?[4,this.db.put(Se,{sessionId:i,events:o.events})]:[2,void 0];case 2:return s=a.sent(),[4,this.db.put(ye,{sessionId:i,events:[]})];case 3:return a.sent(),[2,_(_({},o),{sessionId:i,sequenceId:s})];case 4:return c=a.sent(),this.loggerProvider.warn("".concat(ve,": ").concat(c)),[3,5];case 5:return[2,void 0]}})})},n.addEventToCurrentSequence=function(i,o){return C(n,void 0,void 0,function(){var s,c,a,l,u,m;return w(this,function(d){switch(d.label){case 0:return d.trys.push([0,10,,11]),s=this.db.transaction(ye,"readwrite"),[4,s.store.get(i)];case 1:return c=d.sent(),c?[3,3]:[4,s.store.put({sessionId:i,events:[o]})];case 2:return d.sent(),[2];case 3:return a=void 0,this.shouldSplitEventsList(c.events,o)?(a=c.events,[4,s.store.put({sessionId:i,events:[o]})]):[3,5];case 4:return d.sent(),[3,7];case 5:return l=c.events.concat(o),[4,s.store.put({sessionId:i,events:l})];case 6:d.sent(),d.label=7;case 7:return[4,s.done];case 8:return d.sent(),a?[4,this.storeSendingEvents(i,a)]:[2,void 0];case 9:return u=d.sent(),u?[2,{events:a,sessionId:i,sequenceId:u}]:[2,void 0];case 10:return m=d.sent(),this.loggerProvider.warn("".concat(ve,": ").concat(m)),[3,11];case 11:return[2,void 0]}})})},n.storeSendingEvents=function(i,o){return C(n,void 0,void 0,function(){var s,c;return w(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this.db.put(Se,{sessionId:i,events:o})];case 1:return s=a.sent(),[2,s];case 2:return c=a.sent(),this.loggerProvider.warn("".concat(ve,": ").concat(c)),[3,3];case 3:return[2,void 0]}})})},n.cleanUpSessionEventsStore=function(i,o){return C(n,void 0,void 0,function(){var s;return w(this,function(c){switch(c.label){case 0:if(!o)return[2];c.label=1;case 1:return c.trys.push([1,3,,4]),[4,this.db.delete(Se,o)];case 2:return c.sent(),[3,4];case 3:return s=c.sent(),this.loggerProvider.warn("".concat(ve,": ").concat(s)),[3,4];case 4:return[2]}})})},n.transitionFromKeyValStore=function(i){return C(n,void 0,void 0,function(){var o,s,c,a,l,u,m,d,f=this;return w(this,function(g){switch(g.label){case 0:return g.trys.push([0,6,,7]),[4,fn()];case 1:if(o=g.sent(),!o)return[2];s=function(h,b){return C(f,void 0,void 0,function(){var P,v,p=this;return w(this,function(I){switch(I.label){case 0:return P=b.sessionSequences,v=[],Object.keys(P).forEach(function(E){var R=parseInt(E,10),y=P[R];if(R===b.currentSequenceId){var S=y.events.map(function(T){return C(p,void 0,void 0,function(){return w(this,function(M){return[2,this.addEventToCurrentSequence(h,T)]})})});v.push.apply(v,ue([],Y(S),!1))}else y.status!==Te.SENT&&v.push(p.storeSendingEvents(h,y.events))}),[4,St(v)];case 1:return I.sent(),[2]}})})},c="".concat(ar,"_").concat(this.apiKey.substring(0,10)),g.label=2;case 2:return g.trys.push([2,4,,5]),a=o.transaction("keyval").objectStore("keyval").getAll(c),l=new Promise(function(h){a.onsuccess=function(b){return C(f,void 0,void 0,function(){var P,v,p,I=this;return w(this,function(E){switch(E.label){case 0:return P=b&&b.target.result,v=P&&P[0],v?(p=[],Object.keys(v).forEach(function(R){var y=parseInt(R,10),S=v[y];if(i===y)p.push(s(y,S));else{var T=S.sessionSequences;Object.keys(T).forEach(function(M){var W=parseInt(M,10);T[W].status!==Te.SENT&&p.push(I.storeSendingEvents(y,T[W].events))})}}),[4,St(p)]):[3,2];case 1:E.sent(),E.label=2;case 2:return h(),[2]}})})}}),[4,l];case 3:return g.sent(),u=X(),u&&u.indexedDB.deleteDatabase("keyval-store"),[3,5];case 4:return m=g.sent(),this.loggerProvider.warn("Failed to transition session replay events from keyval to new store: ".concat(m)),[3,5];case 5:return[3,7];case 6:return d=g.sent(),this.loggerProvider.warn("Failed to access keyval store: ".concat(d,". For more information, visit: https://www.docs.developers.amplitude.com/session-replay/sdks/standalone/#indexeddb-best-practices")),[3,7];case 7:return[2]}})})},n.apiKey=r.apiKey,n.db=r.db,n}return e.new=function(r,n,i){return C(this,void 0,void 0,function(){var o,s,c,a,l;return w(this,function(u){switch(u.label){case 0:return u.trys.push([0,3,,4]),o=r==="replay"?"":"_".concat(r),s="".concat(n.apiKey.substring(0,10),"_amp_session_replay_events").concat(o),[4,hn(s)];case 1:return c=u.sent(),a=new e(_(_({},n),{db:c})),[4,a.transitionFromKeyValStore(i)];case 2:return u.sent(),[2,a];case 3:return l=u.sent(),n.loggerProvider.warn("".concat(ve,": ").concat(l)),[3,4];case 4:return[2]}})})},e.prototype.getCurrentSequenceEvents=function(r){return C(this,void 0,void 0,function(){var s,n,i,o,s,c,a,l;return w(this,function(u){switch(u.label){case 0:return r?[4,this.db.get("sessionCurrentSequence",r)]:[3,2];case 1:return s=u.sent(),s?[2,[s]]:[2,void 0];case 2:n=[],u.label=3;case 3:return u.trys.push([3,8,9,10]),[4,this.db.getAll("sessionCurrentSequence")];case 4:i=z.apply(void 0,[u.sent()]),o=i.next(),u.label=5;case 5:if(o.done)return[3,7];s=o.value,n.push(s),u.label=6;case 6:return o=i.next(),[3,5];case 7:return[3,10];case 8:return c=u.sent(),a={error:c},[3,10];case 9:try{o&&!o.done&&(l=i.return)&&l.call(i)}finally{if(a)throw a.error}return[7];case 10:return[2,n]}})})},e}(Vt),pn=function(t){rt(e,t);function e(){var r=t!==null&&t.apply(this,arguments)||this;return r.finalizedSequences={},r.sequences={},r.sequenceId=0,r}return e.prototype.resetCurrentSequence=function(r){this.sequences[r]=[]},e.prototype.addSequence=function(r){var n=this.sequenceId++,i=ue([],Y(this.sequences[r]),!1);return this.finalizedSequences[n]={sessionId:r,events:i},this.resetCurrentSequence(r),{sequenceId:n,events:i,sessionId:r}},e.prototype.getSequencesToSend=function(){return C(this,void 0,void 0,function(){return w(this,function(r){return[2,Object.entries(this.finalizedSequences).map(function(n){var i=Y(n,2),o=i[0],s=i[1],c=s.sessionId,a=s.events;return{sequenceId:Number(o),sessionId:c,events:a}})]})})},e.prototype.storeCurrentSequence=function(r){return C(this,void 0,void 0,function(){return w(this,function(n){return this.sequences[r]?[2,this.addSequence(r)]:[2,void 0]})})},e.prototype.addEventToCurrentSequence=function(r,n){return C(this,void 0,void 0,function(){var i;return w(this,function(o){return this.sequences[r]||this.resetCurrentSequence(r),this.shouldSplitEventsList(this.sequences[r],n)&&(i=this.addSequence(r)),this.sequences[r].push(n),[2,i]})})},e.prototype.storeSendingEvents=function(r,n){return C(this,void 0,void 0,function(){return w(this,function(i){return this.finalizedSequences[this.sequenceId]={sessionId:r,events:n},[2,this.sequenceId++]})})},e.prototype.cleanUpSessionEventsStore=function(r,n){return C(this,void 0,void 0,function(){return w(this,function(i){return n!==void 0&&delete this.finalizedSequences[n],[2]})})},e}(Vt),bt=function(t){var e=t.config,r=t.sessionId,n=t.minInterval,i=t.maxInterval,o=t.type,s=t.payloadBatcher,c=t.storeType;return C(void 0,void 0,void 0,function(){function a(v){return v===void 0&&(v=!1),C(this,void 0,void 0,function(){return w(this,function(p){return[2,l.flush(v)]})})}var l,u,m,d,f,g,h,b,P;return w(this,function(v){switch(v.label){case 0:return l=new Zr(_(_({},e),{loggerProvider:e.loggerProvider,payloadBatcher:s})),u=function(){return new pn({loggerProvider:e.loggerProvider,maxInterval:i,minInterval:n})},m=function(){return C(void 0,void 0,void 0,function(){var p;return w(this,function(I){switch(I.label){case 0:return[4,gn.new(o,{loggerProvider:e.loggerProvider,minInterval:n,maxInterval:i,apiKey:e.apiKey},r)];case 1:return p=I.sent(),e.loggerProvider.log("Failed to initialize idb store, falling back to memory store."),[2,p??u()]}})})},c!=="idb"?[3,2]:[4,m()];case 1:return f=v.sent(),[3,3];case 2:f=u(),v.label=3;case 3:return d=f,g=function(p){var I=p.events,E=p.sessionId,R=p.deviceId,y=p.sequenceId;e.debugMode&&Ft().then(function(S){var T=S.totalStorageSize,M=S.percentOfQuota,W=S.usageDetails;e.loggerProvider.debug("Total storage size: ".concat(T," KB, percentage of quota: ").concat(M,"%, usage details: ").concat(W))}).catch(function(){}),l.sendEventsList({events:I,sessionId:E,flushMaxRetries:e.flushMaxRetries,apiKey:e.apiKey,deviceId:R,sampleRate:e.sampleRate,serverZone:e.serverZone,version:e.version,type:o,onComplete:function(){return C(void 0,void 0,void 0,function(){return w(this,function(S){switch(S.label){case 0:return[4,d.cleanUpSessionEventsStore(E,y)];case 1:return S.sent(),[2]}})})}})},h=function(p){var I=p.sessionId,E=p.deviceId;d.storeCurrentSequence(I).then(function(R){R&&g({sequenceId:R.sequenceId,events:R.events,sessionId:R.sessionId,deviceId:E})}).catch(function(R){e.loggerProvider.warn("Failed to get current sequence of session replay events for session:",R)})},b=function(p){var I=p.deviceId;return C(void 0,void 0,void 0,function(){var E;return w(this,function(R){switch(R.label){case 0:return[4,d.getSequencesToSend()];case 1:return E=R.sent(),E&&E.forEach(function(y){g({sequenceId:y.sequenceId,events:y.events,sessionId:y.sessionId,deviceId:I})}),[2]}})})},P=function(p){var I=p.event,E=p.sessionId,R=p.deviceId;d.addEventToCurrentSequence(E,I.data).then(function(y){return y&&g({sequenceId:y.sequenceId,events:y.events,sessionId:y.sessionId,deviceId:R})}).catch(function(y){e.loggerProvider.warn("Failed to add event to session replay capture:",y)})},[2,{sendCurrentSequenceEvents:h,addEvent:P,sendStoredEvents:b,flush:a}]}})})},Et=function(){function t(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var n=new Map;e.forEach(function(i){n.set(i.name,i.manager)}),this.managers=n}return t.prototype.sendStoredEvents=function(e){return C(this,void 0,void 0,function(){var r;return w(this,function(n){switch(n.label){case 0:return r=[],this.managers.forEach(function(i){r.push(i.sendStoredEvents(e))}),[4,Promise.all(r)];case 1:return n.sent(),[2]}})})},t.prototype.addEvent=function(e){var r,n=e.sessionId,i=e.event,o=e.deviceId;(r=this.managers.get(i.type))===null||r===void 0||r.addEvent({sessionId:n,event:i,deviceId:o})},t.prototype.sendCurrentSequenceEvents=function(e){var r=e.sessionId,n=e.deviceId;this.managers.forEach(function(i){i.sendCurrentSequenceEvents({sessionId:r,deviceId:n})})},t.prototype.flush=function(e){return C(this,void 0,void 0,function(){var r;return w(this,function(n){switch(n.label){case 0:return r=[],this.managers.forEach(function(i){r.push(i.flush(e))}),[4,Promise.all(r)];case 1:return n.sent(),[2]}})})},t}();const wt={Node:["childNodes","parentNode","parentElement","textContent"],ShadowRoot:["host","styleSheets"],Element:["shadowRoot","querySelector","querySelectorAll"],MutationObserver:[]},It={Node:["contains","getRootNode"],ShadowRoot:["getSelection"],Element:[],MutationObserver:["constructor"]},Ie={},mn=()=>!!globalThis.Zone;function it(t){if(Ie[t])return Ie[t];const e=globalThis[t],r=e.prototype,n=t in wt?wt[t]:void 0,i=!!(n&&n.every(c=>{var a,l;return!!((l=(a=Object.getOwnPropertyDescriptor(r,c))==null?void 0:a.get)!=null&&l.toString().includes("[native code]"))})),o=t in It?It[t]:void 0,s=!!(o&&o.every(c=>{var a;return typeof r[c]=="function"&&((a=r[c])==null?void 0:a.toString().includes("[native code]"))}));if(i&&s&&!mn())return Ie[t]=e.prototype,e.prototype;try{const c=document.createElement("iframe");document.body.appendChild(c);const a=c.contentWindow;if(!a)return e.prototype;const l=a[t].prototype;return document.body.removeChild(c),l?Ie[t]=l:r}catch{return r}}const qe={};function ne(t,e,r){var n;const i=`${t}.${String(r)}`;if(qe[i])return qe[i].call(e);const o=it(t),s=(n=Object.getOwnPropertyDescriptor(o,r))==null?void 0:n.get;return s?(qe[i]=s,s.call(e)):e[r]}const Ne={};function Xt(t,e,r){const n=`${t}.${String(r)}`;if(Ne[n])return Ne[n].bind(e);const o=it(t)[r];return typeof o!="function"?e[r]:(Ne[n]=o,o.bind(e))}function yn(t){return ne("Node",t,"childNodes")}function Sn(t){return ne("Node",t,"parentNode")}function bn(t){return ne("Node",t,"parentElement")}function En(t){return ne("Node",t,"textContent")}function wn(t,e){return Xt("Node",t,"contains")(e)}function In(t){return Xt("Node",t,"getRootNode")()}function Cn(t){return!t||!("host"in t)?null:ne("ShadowRoot",t,"host")}function Rn(t){return t.styleSheets}function Pn(t){return!t||!("shadowRoot"in t)?null:ne("Element",t,"shadowRoot")}function _n(t,e){return ne("Element",t,"querySelector")(e)}function Tn(t,e){return ne("Element",t,"querySelectorAll")(e)}function kn(){return it("MutationObserver").constructor}const Ct={childNodes:yn,parentNode:Sn,parentElement:bn,textContent:En,contains:wn,getRootNode:In,host:Cn,styleSheets:Rn,shadowRoot:Pn,querySelector:_n,querySelectorAll:Tn,mutationObserver:kn};function Ln(t){var e,r,n,i,o=t.document;return{left:o.scrollingElement?o.scrollingElement.scrollLeft:t.pageXOffset!==void 0?t.pageXOffset:o.documentElement.scrollLeft||(o==null?void 0:o.body)&&((e=Ct.parentElement(o.body))===null||e===void 0?void 0:e.scrollLeft)||((r=o==null?void 0:o.body)===null||r===void 0?void 0:r.scrollLeft)||0,top:o.scrollingElement?o.scrollingElement.scrollTop:t.pageYOffset!==void 0?t.pageYOffset:(o==null?void 0:o.documentElement.scrollTop)||(o==null?void 0:o.body)&&((n=Ct.parentElement(o.body))===null||n===void 0?void 0:n.scrollTop)||((i=o==null?void 0:o.body)===null||i===void 0?void 0:i.scrollTop)||0}}function Ue(){var t=X();return(t==null?void 0:t.innerHeight)||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight||0}function Fe(){var t=X();return(t==null?void 0:t.innerWidth)||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth||0}var j,ot,Ht;function Mn(t,e){if(Ht=new Date,t.nodeType!==Node.ELEMENT_NODE)throw new Error("Can't generate CSS selector for non-element node type.");if(t.tagName.toLowerCase()==="html")return"html";var r={root:document.body,idName:function(o){return!0},className:function(o){return!0},tagName:function(o){return!0},attr:function(o,s){return!1},seedMinLength:1,optimizedMinLength:2,threshold:1e3,maxNumberOfTries:1e4,timeoutMs:void 0};j=_(_({},r),e),ot=Dn(j.root,r);var n=Ce(t,"all",function(){return Ce(t,"two",function(){return Ce(t,"one",function(){return Ce(t,"none")})})});if(n){var i=$t(Zt(n,t));return i.length>0&&(n=i[0]),Me(n)}else throw new Error("Selector was not found.")}function Dn(t,e){return t.nodeType===Node.DOCUMENT_NODE?t:t===e.root?t.ownerDocument:t}function Ce(t,e,r){for(var n=null,i=[],o=t,s=0,c=function(){var l,u,m=new Date().getTime()-Ht.getTime();if(j.timeoutMs!==void 0&&m>j.timeoutMs)throw new Error("Timeout: Can't find a unique selector after ".concat(m,"ms"));var d=Pe(On(o))||Pe.apply(void 0,ue([],Y(xn(o)),!1))||Pe.apply(void 0,ue([],Y(An(o)),!1))||Pe(qn(o))||[_t()],f=Nn(o);if(e=="all")f&&(d=d.concat(d.filter(Be).map(function(v){return Re(v,f)})));else if(e=="two")d=d.slice(0,1),f&&(d=d.concat(d.filter(Be).map(function(v){return Re(v,f)})));else if(e=="one"){var g=Y(d=d.slice(0,1),1),h=g[0];f&&Be(h)&&(d=[Re(h,f)])}else e=="none"&&(d=[_t()],f&&(d=[Re(d[0],f)]));try{for(var b=(l=void 0,z(d)),P=b.next();!P.done;P=b.next()){var h=P.value;h.level=s}}catch(v){l={error:v}}finally{try{P&&!P.done&&(u=b.return)&&u.call(b)}finally{if(l)throw l.error}}if(i.push(d),i.length>=j.seedMinLength&&(n=Rt(i,r),n))return"break";o=o.parentElement,s++};o;){var a=c();if(a==="break")break}return n||(n=Rt(i,r)),!n&&r?r():n}function Rt(t,e){var r,n,i=$t(Yt(t));if(i.length>j.threshold)return e?e():null;try{for(var o=z(i),s=o.next();!s.done;s=o.next()){var c=s.value;if(Qt(c))return c}}catch(a){r={error:a}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return null}function Me(t){for(var e=t[0],r=e.name,n=1;n<t.length;n++){var i=t[n].level||0;e.level===i-1?r="".concat(t[n].name," > ").concat(r):r="".concat(t[n].name," ").concat(r),e=t[n]}return r}function Pt(t){return t.map(function(e){return e.penalty}).reduce(function(e,r){return e+r},0)}function Qt(t){var e=Me(t);switch(ot.querySelectorAll(e).length){case 0:throw new Error("Can't select any node with this selector: ".concat(e));case 1:return!0;default:return!1}}function On(t){var e=t.getAttribute("id");return e&&j.idName(e)?{name:"#"+CSS.escape(e),penalty:0}:null}function xn(t){var e=Array.from(t.attributes).filter(function(r){return j.attr(r.name,r.value)});return e.map(function(r){return{name:"[".concat(CSS.escape(r.name),'="').concat(CSS.escape(r.value),'"]'),penalty:.5}})}function An(t){var e=Array.from(t.classList).filter(j.className);return e.map(function(r){return{name:"."+CSS.escape(r),penalty:1}})}function qn(t){var e=t.tagName.toLowerCase();return j.tagName(e)?{name:e,penalty:2}:null}function _t(){return{name:"*",penalty:3}}function Nn(t){var e=t.parentNode;if(!e)return null;var r=e.firstChild;if(!r)return null;for(var n=0;r&&(r.nodeType===Node.ELEMENT_NODE&&n++,r!==t);)r=r.nextSibling;return n}function Re(t,e){return{name:t.name+":nth-child(".concat(e,")"),penalty:t.penalty+1}}function Be(t){return t.name!=="html"&&!t.name.startsWith("#")}function Pe(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=t.filter(Un);return r.length>0?r:null}function Un(t){return t!=null}function Yt(t,e){var r,n,i,o,s,c;return e===void 0&&(e=[]),w(this,function(a){switch(a.label){case 0:if(!(t.length>0))return[3,9];a.label=1;case 1:a.trys.push([1,6,7,8]),r=z(t[0]),n=r.next(),a.label=2;case 2:return n.done?[3,5]:(i=n.value,[5,z(Yt(t.slice(1,t.length),e.concat(i)))]);case 3:a.sent(),a.label=4;case 4:return n=r.next(),[3,2];case 5:return[3,8];case 6:return o=a.sent(),s={error:o},[3,8];case 7:try{n&&!n.done&&(c=r.return)&&c.call(r)}finally{if(s)throw s.error}return[7];case 8:return[3,11];case 9:return[4,e];case 10:a.sent(),a.label=11;case 11:return[2]}})}function $t(t){return ue([],Y(t),!1).sort(function(e,r){return Pt(e)-Pt(r)})}function Zt(t,e,r){var n,i,o;return r===void 0&&(r={counter:0,visited:new Map}),w(this,function(s){switch(s.label){case 0:if(!(t.length>2&&t.length>j.optimizedMinLength))return[3,5];n=1,s.label=1;case 1:return n<t.length-1?r.counter>j.maxNumberOfTries?[2]:(r.counter+=1,i=ue([],Y(t),!1),i.splice(n,1),o=Me(i),r.visited.has(o)?[2]:Qt(i)&&Fn(i,e)?[4,i]:[3,4]):[3,5];case 2:return s.sent(),r.visited.set(o,!0),[5,z(Zt(i,e,r))];case 3:s.sent(),s.label=4;case 4:return n++,[3,1];case 5:return[2]}})}function Fn(t,e){return ot.querySelector(Me(t))===e}var Bn=36e5,Kn=function(t){var e=t.version,r=t.events,n=[];return r.forEach(function(i){var o=JSON.parse(i);o.count=1,o.type==="click"&&n.push(o)}),{version:e,events:n}},Gn=function(t){var e=t.version,r=t.events,n=[];r.forEach(function(o){var s=JSON.parse(o);s.type==="click"&&n.push(s)});var i=n.reduce(function(o,s){var c=s.x,a=s.y,l=s.selector,u=s.timestamp,m=u-u%Bn,d="".concat(c,":").concat(a,":").concat(l??"",":").concat(m);return o[d]?o[d].count+=1:o[d]=_(_({},s),{timestamp:m,count:1}),o},{});return{version:e,events:Object.values(i)}},Wn=function(t,e){var r=e.eventsManager,n=e.sessionId,i=e.deviceIdFn,o=e.mirror,s=e.ugcFilterRules;return function(c){if(c.type===Wt.Click){var a=X();if(a){var l=a.location,u=a.innerHeight,m=a.innerWidth;if(l){var d=c.x,f=c.y;if(!(d===void 0||f===void 0)){var g=o.getNode(c.id),h;if(g)try{h=Mn(g)}catch{t.debug("error resolving selector from finder")}var b=Ln(a),P=b.left,v=b.top,p=nt(l.href,s),I={x:d+P,y:f+v,selector:h,viewportHeight:u,viewportWidth:m,pageUrl:p,timestamp:Date.now(),type:"click"},E=i();E&&r.addEvent({sessionId:n,event:{type:"interaction",data:JSON.stringify(I)},deviceId:E})}}}}}},zn=function(){function t(e,r){var n=X();n&&n.navigator&&typeof n.navigator.sendBeacon=="function"?this.sendBeacon=function(i,o){try{if(n.navigator.sendBeacon(i,JSON.stringify(o)))return!0}catch{}return!1}:this.sendBeacon=function(){return!1},this.sendXhr=function(i,o){var s=new XMLHttpRequest;return s.open("POST",i,!0),s.setRequestHeader("Accept","*/*"),s.send(JSON.stringify(o)),!0},this.basePageUrl=Ut(r.serverZone,r.trackServerUrl),this.apiKey=r.apiKey,this.context=e}return t.prototype.send=function(e,r){var n=this.context,i=n.sessionId,o=n.type,s=new URLSearchParams({device_id:e,session_id:String(i),type:String(o),api_key:this.apiKey}),c="".concat(this.basePageUrl,"?").concat(s.toString());this.sendBeacon(c,r)||this.sendXhr(c,r)},t}(),jn=function(){function t(e,r){var n=this;this.timestamp=Date.now(),this.hook=function(i){n.update(i)},this.send=function(i){return function(o){var s,c,a=i(),l=X();l&&a&&n.transport.send(a,{version:1,events:[{maxScrollX:n._maxScrollX,maxScrollY:n._maxScrollY,maxScrollWidth:n._maxScrollWidth,maxScrollHeight:n._maxScrollHeight,viewportHeight:Ue(),viewportWidth:Fe(),pageUrl:nt(l.location.href,(c=(s=n.config.interactionConfig)===null||s===void 0?void 0:s.ugcFilterRules)!==null&&c!==void 0?c:[]),timestamp:n.timestamp,type:"scroll"}]})}},this._maxScrollX=0,this._maxScrollY=0,this._maxScrollWidth=Fe(),this._maxScrollHeight=Ue(),this.config=r,this.transport=e}return t.default=function(e,r){return new t(new zn(e,r),r)},Object.defineProperty(t.prototype,"maxScrollX",{get:function(){return this._maxScrollX},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxScrollY",{get:function(){return this._maxScrollY},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxScrollWidth",{get:function(){return this._maxScrollWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxScrollHeight",{get:function(){return this._maxScrollHeight},enumerable:!1,configurable:!0}),t.prototype.update=function(e){var r=Date.now();if(e.x>this._maxScrollX){var n=Fe();this._maxScrollX=e.x;var i=e.x+n;i>this._maxScrollWidth&&(this._maxScrollWidth=i),this.timestamp=r}if(e.y>this._maxScrollY){var o=Ue();this._maxScrollY=e.y;var s=e.y+o;s>this._maxScrollHeight&&(this._maxScrollHeight=s),this.timestamp=r}},t}(),Tt=function(){function t(e){var r=e.sessionId,n=e.deviceId;this.deviceId=n,this.sessionId=r,r&&n&&(this.sessionReplayId=kr(r,n))}return t}(),V=Uint8Array,F=Uint16Array,we=Uint32Array,st=new V([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),at=new V([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),kt=new V([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Jt=function(t,e){for(var r=new F(31),n=0;n<31;++n)r[n]=e+=1<<t[n-1];for(var i=new we(r[30]),n=1;n<30;++n)for(var o=r[n];o<r[n+1];++o)i[o]=o-r[n]<<5|n;return[r,i]},er=Jt(st,2),Vn=er[0],Ze=er[1];Vn[28]=258,Ze[258]=28;var Xn=Jt(at,0),Lt=Xn[1],Je=new F(32768);for(var k=0;k<32768;++k){var re=(k&43690)>>>1|(k&21845)<<1;re=(re&52428)>>>2|(re&13107)<<2,re=(re&61680)>>>4|(re&3855)<<4,Je[k]=((re&65280)>>>8|(re&255)<<8)>>>1}var be=function(t,e,r){for(var n=t.length,i=0,o=new F(e);i<n;++i)++o[t[i]-1];var s=new F(e);for(i=0;i<e;++i)s[i]=s[i-1]+o[i-1]<<1;var c;if(r){c=new F(1<<e);var a=15-e;for(i=0;i<n;++i)if(t[i])for(var l=i<<4|t[i],u=e-t[i],m=s[t[i]-1]++<<u,d=m|(1<<u)-1;m<=d;++m)c[Je[m]>>>a]=l}else for(c=new F(n),i=0;i<n;++i)c[i]=Je[s[t[i]-1]++]>>>15-t[i];return c},le=new V(288);for(var k=0;k<144;++k)le[k]=8;for(var k=144;k<256;++k)le[k]=9;for(var k=256;k<280;++k)le[k]=7;for(var k=280;k<288;++k)le[k]=8;var ke=new V(32);for(var k=0;k<32;++k)ke[k]=5;var Hn=be(le,9,0),Qn=be(ke,5,0),tr=function(t){return(t/8>>0)+(t&7&&1)},rr=function(t,e,r){(r==null||r>t.length)&&(r=t.length);var n=new(t instanceof F?F:t instanceof we?we:V)(r-e);return n.set(t.subarray(e,r)),n},J=function(t,e,r){r<<=e&7;var n=e/8>>0;t[n]|=r,t[n+1]|=r>>>8},pe=function(t,e,r){r<<=e&7;var n=e/8>>0;t[n]|=r,t[n+1]|=r>>>8,t[n+2]|=r>>>16},Ke=function(t,e){for(var r=[],n=0;n<t.length;++n)t[n]&&r.push({s:n,f:t[n]});var i=r.length,o=r.slice();if(!i)return[new V(0),0];if(i==1){var s=new V(r[0].s+1);return s[r[0].s]=1,[s,1]}r.sort(function(E,R){return E.f-R.f}),r.push({s:-1,f:25001});var c=r[0],a=r[1],l=0,u=1,m=2;for(r[0]={s:-1,f:c.f+a.f,l:c,r:a};u!=i-1;)c=r[r[l].f<r[m].f?l++:m++],a=r[l!=u&&r[l].f<r[m].f?l++:m++],r[u++]={s:-1,f:c.f+a.f,l:c,r:a};for(var d=o[0].s,n=1;n<i;++n)o[n].s>d&&(d=o[n].s);var f=new F(d+1),g=et(r[u-1],f,0);if(g>e){var n=0,h=0,b=g-e,P=1<<b;for(o.sort(function(R,y){return f[y.s]-f[R.s]||R.f-y.f});n<i;++n){var v=o[n].s;if(f[v]>e)h+=P-(1<<g-f[v]),f[v]=e;else break}for(h>>>=b;h>0;){var p=o[n].s;f[p]<e?h-=1<<e-f[p]++-1:++n}for(;n>=0&&h;--n){var I=o[n].s;f[I]==e&&(--f[I],++h)}g=e}return[new V(f),g]},et=function(t,e,r){return t.s==-1?Math.max(et(t.l,e,r+1),et(t.r,e,r+1)):e[t.s]=r},Mt=function(t){for(var e=t.length;e&&!t[--e];);for(var r=new F(++e),n=0,i=t[0],o=1,s=function(a){r[n++]=a},c=1;c<=e;++c)if(t[c]==i&&c!=e)++o;else{if(!i&&o>2){for(;o>138;o-=138)s(32754);o>2&&(s(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(s(i),--o;o>6;o-=6)s(8304);o>2&&(s(o-3<<5|8208),o=0)}for(;o--;)s(i);o=1,i=t[c]}return[r.subarray(0,n),e]},me=function(t,e){for(var r=0,n=0;n<e.length;++n)r+=t[n]*e[n];return r},tt=function(t,e,r){var n=r.length,i=tr(e+2);t[i]=n&255,t[i+1]=n>>>8,t[i+2]=t[i]^255,t[i+3]=t[i+1]^255;for(var o=0;o<n;++o)t[i+o+4]=r[o];return(i+4+n)*8},Dt=function(t,e,r,n,i,o,s,c,a,l,u){J(e,u++,r),++i[256];for(var m=Ke(i,15),d=m[0],f=m[1],g=Ke(o,15),h=g[0],b=g[1],P=Mt(d),v=P[0],p=P[1],I=Mt(h),E=I[0],R=I[1],y=new F(19),S=0;S<v.length;++S)y[v[S]&31]++;for(var S=0;S<E.length;++S)y[E[S]&31]++;for(var T=Ke(y,7),M=T[0],W=T[1],L=19;L>4&&!M[kt[L-1]];--L);var A=l+5<<3,q=me(i,le)+me(o,ke)+s,B=me(i,d)+me(o,h)+s+14+3*L+me(y,M)+(2*y[16]+3*y[17]+7*y[18]);if(A<=q&&A<=B)return tt(e,u,t.subarray(a,a+l));var K,D,N,H;if(J(e,u,1+(B<q)),u+=2,B<q){K=be(d,f,0),D=d,N=be(h,b,0),H=h;var ie=be(M,W,0);J(e,u,p-257),J(e,u+5,R-1),J(e,u+10,L-4),u+=14;for(var S=0;S<L;++S)J(e,u+3*S,M[kt[S]]);u+=3*L;for(var G=[v,E],$=0;$<2;++$)for(var Q=G[$],S=0;S<Q.length;++S){var U=Q[S]&31;J(e,u,ie[U]),u+=M[U],U>15&&(J(e,u,Q[S]>>>5&127),u+=Q[S]>>>12)}}else K=Hn,D=le,N=Qn,H=ke;for(var S=0;S<c;++S)if(n[S]>255){var U=n[S]>>>18&31;pe(e,u,K[U+257]),u+=D[U+257],U>7&&(J(e,u,n[S]>>>23&31),u+=st[U]);var O=n[S]&31;pe(e,u,N[O]),u+=H[O],O>3&&(pe(e,u,n[S]>>>5&8191),u+=at[O])}else pe(e,u,K[n[S]]),u+=D[n[S]];return pe(e,u,K[256]),u+D[256]},Yn=new we([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),$n=function(t,e,r,n,i,o){var s=t.length,c=new V(n+s+5*(1+Math.floor(s/7e3))+i),a=c.subarray(n,c.length-i),l=0;if(!e||s<8)for(var u=0;u<=s;u+=65535){var m=u+65535;m<s?l=tt(a,l,t.subarray(u,m)):(a[u]=o,l=tt(a,l,t.subarray(u,s)))}else{for(var d=Yn[e-1],f=d>>>13,g=d&8191,h=(1<<r)-1,b=new F(32768),P=new F(h+1),v=Math.ceil(r/3),p=2*v,I=function(De){return(t[De]^t[De+1]<<v^t[De+2]<<p)&h},E=new we(25e3),R=new F(288),y=new F(32),S=0,T=0,u=0,M=0,W=0,L=0;u<s;++u){var A=I(u),q=u&32767,B=P[A];if(b[q]=B,P[A]=q,W<=u){var K=s-u;if((S>7e3||M>24576)&&K>423){l=Dt(t,a,0,E,R,y,T,M,L,u-L,l),M=S=T=0,L=u;for(var D=0;D<286;++D)R[D]=0;for(var D=0;D<30;++D)y[D]=0}var N=2,H=0,ie=g,G=q-B&32767;if(K>2&&A==I(u-G))for(var $=Math.min(f,K)-1,Q=Math.min(32767,u),U=Math.min(258,K);G<=Q&&--ie&&q!=B;){if(t[u+N]==t[u+N-G]){for(var O=0;O<U&&t[u+O]==t[u+O-G];++O);if(O>N){if(N=O,H=G,O>$)break;for(var oe=Math.min(G,O-2),se=0,D=0;D<oe;++D){var Z=u-G+D+32768&32767,de=b[Z],ee=Z-de+32768&32767;ee>se&&(se=ee,B=Z)}}}q=B,B=b[q],G+=q-B+32768&32767}if(H){E[M++]=268435456|Ze[N]<<18|Lt[H];var te=Ze[N]&31,ct=Lt[H]&31;T+=st[te]+at[ct],++R[257+te],++y[ct],W=u+N,++S}else E[M++]=t[u],++R[t[u]]}}l=Dt(t,a,o,E,R,y,T,M,L,u-L,l)}return rr(c,0,n+tr(l)+i)},Zn=function(){var t=1,e=0;return{p:function(r){for(var n=t,i=e,o=r.length,s=0;s!=o;){for(var c=Math.min(s+5552,o);s<c;++s)n+=r[s],i+=n;n%=65521,i%=65521}t=n,e=i},d:function(){return(t>>>8<<16|(e&255)<<8|e>>>8)+((t&255)<<23)*2}}},Jn=function(t,e,r,n,i){return $n(t,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(t.length)))*1.5):12+e.mem,r,n,!0)},ei=function(t,e,r){for(;r;++e)t[e]=r,r>>>=8},ti=function(t,e){var r=e.level,n=r==0?0:r<6?1:r==9?3:2;t[0]=120,t[1]=n<<6|(n?32-2*n:1)};function ri(t,e){e===void 0&&(e={});var r=Zn();r.p(t);var n=Jn(t,e,2,4);return ti(n,e),ei(n,n.length-4,r.d()),n}function ni(t,e){var r=t.length;if(typeof TextEncoder<"u")return new TextEncoder().encode(t);for(var n=new V(t.length+(t.length>>>1)),i=0,o=function(l){n[i++]=l},s=0;s<r;++s){if(i+5>n.length){var c=new V(i+8+(r-s<<1));c.set(n),n=c}var a=t.charCodeAt(s);a<128||e?o(a):a<2048?(o(192|a>>>6),o(128|a&63)):a>55295&&a<57344?(a=65536+(a&1047552)|t.charCodeAt(++s)&1023,o(240|a>>>18),o(128|a>>>12&63),o(128|a>>>6&63),o(128|a&63)):(o(224|a>>>12),o(128|a>>>6&63),o(128|a&63))}return rr(n,0,i)}function ii(t,e){for(var r="",n=0;n<t.length;){var i=t[n++];r+=String.fromCharCode(i)}return r}const oi="v1",si=t=>{const e={...t,v:oi};return ii(ri(ni(JSON.stringify(e))))};var ai=2e3,ci=function(){function t(e,r,n,i){var o=this,s,c,a;this.taskQueue=[],this.isProcessing=!1,this.compressEvent=function(f){var g=si(f);return JSON.stringify(g)},this.addCompressedEventToManager=function(f,g){o.eventsManager&&o.deviceId&&o.eventsManager.addEvent({event:{type:"replay",data:f},sessionId:g,deviceId:o.deviceId})},this.addCompressedEvent=function(f,g){if(o.worker)o.worker.postMessage({event:f,sessionId:g});else{var h=o.compressEvent(f);o.addCompressedEventToManager(h,g)}},this.terminate=function(){var f;(f=o.worker)===null||f===void 0||f.terminate()};var l=X();this.canUseIdleCallback=l&&"requestIdleCallback"in l,this.eventsManager=e,this.config=r,this.deviceId=n,this.timeout=((s=r.performanceConfig)===null||s===void 0?void 0:s.timeout)||ai;var u={},m=(c=u.COMPRESSION_WEBWORKER_BODY)!==null&&c!==void 0?c:i;if(!((a=this.config.experimental)===null||a===void 0)&&a.useWebWorker&&l&&l.Worker&&m){r.loggerProvider.log("[Experimental] Enabling web worker for compression");var d=new Worker(URL.createObjectURL(new Blob([m],{type:"application/javascript"})));d.onerror=function(f){r.loggerProvider.error(f)},d.onmessage=function(f){var g=f.data,h=g.compressedEvent,b=g.sessionId;o.addCompressedEventToManager(h,b)},this.worker=d}}return t.prototype.scheduleIdleProcessing=function(){var e=this;this.isProcessing||(this.isProcessing=!0,requestIdleCallback(function(r){e.processQueue(r)},{timeout:this.timeout}))},t.prototype.enqueueEvent=function(e,r){var n;this.canUseIdleCallback&&(!((n=this.config.performanceConfig)===null||n===void 0)&&n.enabled)?(this.config.loggerProvider.debug("Enqueuing event for processing during idle time."),this.taskQueue.push({event:e,sessionId:r}),this.scheduleIdleProcessing()):(this.config.loggerProvider.debug("Processing event without idle callback."),this.addCompressedEvent(e,r))},t.prototype.processQueue=function(e){for(var r=this;this.taskQueue.length>0&&(e.timeRemaining()>0||e.didTimeout);){var n=this.taskQueue.shift();if(n){var i=n.event,o=n.sessionId;this.addCompressedEvent(i,o)}}this.taskQueue.length>0?requestIdleCallback(function(s){r.processQueue(s)},{timeout:this.timeout}):this.isProcessing=!1},t}(),ui=function(){function t(){var e=this;this.name="@amplitude/session-replay-browser",this.recordCancelCallback=null,this.eventCount=0,this.pageLeaveFns=[],this.recordFunction=null,this.teardownEventListeners=function(r){var n=X();n&&(n.removeEventListener("blur",e.blurListener),n.removeEventListener("focus",e.focusListener),!r&&n.addEventListener("blur",e.blurListener),!r&&n.addEventListener("focus",e.focusListener),n.self&&"onpagehide"in n.self?(n.removeEventListener("pagehide",e.pageLeaveListener),!r&&n.addEventListener("pagehide",e.pageLeaveListener)):(n.removeEventListener("beforeunload",e.pageLeaveListener),!r&&n.addEventListener("beforeunload",e.pageLeaveListener)))},this.blurListener=function(){e.sendEvents()},this.focusListener=function(){e.recordEvents(!1)},this.pageLeaveListener=function(r){e.pageLeaveFns.forEach(function(n){n(r)})},this.addCustomRRWebEvent=function(r,n,i){return n===void 0&&(n={}),i===void 0&&(i=!0),C(e,void 0,void 0,function(){var o,s,c,a;return w(this,function(l){switch(l.label){case 0:return l.trys.push([0,3,,4]),o=void 0,s=this.config,s&&r!==ae.METADATA?(o={config:Bt(s),version:Ve},i?[4,Ft()]:[3,2]):[3,2];case 1:c=l.sent(),o=_(_({},c),o),l.label=2;case 2:return this.recordCancelCallback&&this.recordFunction?this.recordFunction.addCustomEvent(r,_(_({},n),o)):this.loggerProvider.debug("Not able to add custom replay capture event ".concat(r," due to no ongoing recording.")),[3,4];case 3:return a=l.sent(),this.loggerProvider.debug("Error while adding custom replay capture event: ",a),[3,4];case 4:return[2]}})})},this.stopRecordingEvents=function(){var r;try{e.loggerProvider.log("Session Replay capture stopping."),e.recordCancelCallback&&e.recordCancelCallback(),e.recordCancelCallback=null,(r=e.networkObservers)===null||r===void 0||r.stop()}catch(i){var n=i;e.loggerProvider.warn("Error occurred while stopping replay capture: ".concat(n.toString()))}},this.loggerProvider=new We(new Ge)}return t.prototype.init=function(e,r){return lt(this._init(e,r))},t.prototype._init=function(e,r){var n,i,o,s,c,a;return C(this,void 0,void 0,function(){var l,u,m,d,f,g,h,b,P,v,R,p,I,E,R;return w(this,function(y){switch(y.label){case 0:return this.loggerProvider=new We(r.loggerProvider||new Ge),Object.prototype.hasOwnProperty.call(r,"logLevel")&&this.loggerProvider.enable(r.logLevel),this.identifiers=new Tt({sessionId:r.sessionId,deviceId:r.deviceId}),l=this,[4,Vr(e,r)];case 1:return l.joinedConfigGenerator=y.sent(),[4,this.joinedConfigGenerator.generateJoinedConfig(this.identifiers.sessionId)];case 2:u=y.sent(),m=u.joinedConfig,d=u.localConfig,f=u.remoteConfig,this.config=m,this.setMetadata(r.sessionId,m,d,f,(n=r.version)===null||n===void 0?void 0:n.version,Ve,(i=r.version)===null||i===void 0?void 0:i.type),r.sessionId&&(!((o=this.config.interactionConfig)===null||o===void 0)&&o.enabled)&&(g=jn.default({sessionId:r.sessionId,type:"interaction"},this.config),this.pageLeaveFns=[g.send(this.getDeviceId.bind(this)).bind(g)],this.scrollHook=g.hook.bind(g)),h=[],b=this.config.storeType,b==="idb"&&!(!((s=X())===null||s===void 0)&&s.indexedDB)&&(b="memory",this.loggerProvider.warn("Could not use preferred indexedDB storage, reverting to in memory option.")),this.loggerProvider.log("Using ".concat(b," for event storage.")),y.label=3;case 3:return y.trys.push([3,5,,6]),[4,bt({config:this.config,sessionId:this.identifiers.sessionId,type:"replay",storeType:b})];case 4:return P=y.sent(),h.push({name:"replay",manager:P}),[3,6];case 5:return v=y.sent(),R=v,this.loggerProvider.warn("Error occurred while creating replay events manager: ".concat(R.toString())),[3,6];case 6:if(!(!((c=this.config.interactionConfig)===null||c===void 0)&&c.enabled))return[3,10];p=this.config.interactionConfig.batch?Gn:Kn,y.label=7;case 7:return y.trys.push([7,9,,10]),[4,bt({config:this.config,sessionId:this.identifiers.sessionId,type:"interaction",minInterval:(a=this.config.interactionConfig.trackEveryNms)!==null&&a!==void 0?a:Sr,maxInterval:br,payloadBatcher:p,storeType:b})];case 8:return I=y.sent(),h.push({name:"interaction",manager:I}),[3,10];case 9:return E=y.sent(),R=E,this.loggerProvider.warn("Error occurred while creating interaction events manager: ".concat(R.toString())),[3,10];case 10:return this.eventsManager=new(Et.bind.apply(Et,ue([void 0],Y(h),!1))),this.eventCompressor&&this.eventCompressor.terminate(),this.eventCompressor=new ci(this.eventsManager,this.config,this.getDeviceId()),[4,this.initializeNetworkObservers()];case 11:return y.sent(),this.loggerProvider.log("Installing @amplitude/session-replay-browser."),this.teardownEventListeners(!1),this.initialize(!0),[2]}})})},t.prototype.setSessionId=function(e,r){return lt(this.asyncSetSessionId(e,r))},t.prototype.asyncSetSessionId=function(e,r){return C(this,void 0,void 0,function(){var n,i,o;return w(this,function(s){switch(s.label){case 0:return n=this.identifiers&&this.identifiers.sessionId,n&&this.sendEvents(n),i=r||this.getDeviceId(),this.identifiers=new Tt({sessionId:e,deviceId:i}),this.joinedConfigGenerator&&n?[4,this.joinedConfigGenerator.generateJoinedConfig(this.identifiers.sessionId)]:[3,2];case 1:o=s.sent().joinedConfig,this.config=o,s.label=2;case 2:return this.recordEvents(),[2]}})})},t.prototype.getSessionReplayProperties=function(){var e,r=this.config,n=this.identifiers;if(!r||!n)return this.loggerProvider.warn("Session replay init has not been called, cannot get session replay properties."),{};var i=this.getShouldRecord(),o={};return i&&(o=(e={},e[ur]=n.sessionReplayId?n.sessionReplayId:null,e),r.debugMode&&(o[fr]=JSON.stringify({appHash:je(r.apiKey).toString()}))),this.addCustomRRWebEvent(ae.GET_SR_PROPS,{shouldRecord:i,eventProperties:o},this.eventCount===10),this.eventCount===10&&(this.eventCount=0),this.eventCount++,o},t.prototype.sendEvents=function(e){var r,n=e||((r=this.identifiers)===null||r===void 0?void 0:r.sessionId),i=this.getDeviceId();this.eventsManager&&n&&i&&this.eventsManager.sendCurrentSequenceEvents({sessionId:n,deviceId:i})},t.prototype.initialize=function(e){var r;return e===void 0&&(e=!1),C(this,void 0,void 0,function(){var n;return w(this,function(i){return!((r=this.identifiers)===null||r===void 0)&&r.sessionId?(n=this.getDeviceId(),n?(this.eventsManager&&e&&this.eventsManager.sendStoredEvents({deviceId:n}),[2,this.recordEvents()]):(this.loggerProvider.log("Session is not being recorded due to lack of device id."),[2,Promise.resolve()])):(this.loggerProvider.log("Session is not being recorded due to lack of session id."),[2,Promise.resolve()])})})},t.prototype.shouldOptOut=function(){var e,r,n;if(!((e=this.config)===null||e===void 0)&&e.instanceName){var i=cr(this.config.instanceName).identityStore;n=i.getIdentity().optOut}return n!==void 0?n:(r=this.config)===null||r===void 0?void 0:r.optOut},t.prototype.getShouldRecord=function(){if(!this.identifiers||!this.config||!this.identifiers.sessionId)return this.loggerProvider.warn("Session is not being recorded due to lack of config, please call sessionReplay.init."),!1;if(!this.config.captureEnabled)return this.loggerProvider.log("Session ".concat(this.identifiers.sessionId," not being captured due to capture being disabled for project or because the remote config could not be fetched.")),!1;if(this.shouldOptOut())return this.loggerProvider.log("Opting session ".concat(this.identifiers.sessionId," out of recording due to optOut config.")),!1;var e=_r(this.identifiers.sessionId,this.config.sampleRate);return e||this.loggerProvider.log("Opting session ".concat(this.identifiers.sessionId," out of recording due to sample rate.")),e},t.prototype.getBlockSelectors=function(){var e,r,n,i=(n=(r=(e=this.config)===null||e===void 0?void 0:e.privacyConfig)===null||r===void 0?void 0:r.blockSelector)!==null&&n!==void 0?n:[];if(i.length!==0)return i},t.prototype.getMaskTextSelectors=function(){var e,r,n,i;if(((r=(e=this.config)===null||e===void 0?void 0:e.privacyConfig)===null||r===void 0?void 0:r.defaultMaskLevel)==="conservative")return"*";var o=(i=(n=this.config)===null||n===void 0?void 0:n.privacyConfig)===null||i===void 0?void 0:i.maskSelector;if(o)return o},t.prototype.getRecordingPlugins=function(e){var r;return C(this,void 0,void 0,function(){var n,i,o;return w(this,function(s){switch(s.label){case 0:if(n=[],!(!((r=e==null?void 0:e.console)===null||r===void 0)&&r.enabled))return[3,4];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,Oe(()=>import("./rrweb-plugin-console-record-D7nydZmM.js"),[])];case 2:return i=s.sent().getRecordConsolePlugin,n.push(i({level:e.console.levels})),[3,4];case 3:return o=s.sent(),this.loggerProvider.warn("Failed to load console plugin:",o),[3,4];case 4:return[2,n.length>0?n:void 0]}})})},t.prototype.getRecordFunction=function(){return C(this,void 0,void 0,function(){var e,r;return w(this,function(n){switch(n.label){case 0:if(this.recordFunction)return[2,this.recordFunction];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,Oe(()=>import("./rrweb-record-DIzJdX4e.js"),[])];case 2:return e=n.sent().record,this.recordFunction=e,[2,e];case 3:return r=n.sent(),this.loggerProvider.warn("Failed to load rrweb-record module:",r),[2,null];case 4:return[2]}})})},t.prototype.recordEvents=function(e){var r,n,i;return e===void 0&&(e=!0),C(this,void 0,void 0,function(){var o,s,c,a,l,u,m,d,f,g,h,b,P,v=this;return w(this,function(p){switch(p.label){case 0:return o=this.config,s=this.getShouldRecord(),c=(r=this.identifiers)===null||r===void 0?void 0:r.sessionId,!s||!c||!o?[2]:(this.stopRecordingEvents(),[4,this.getRecordFunction()]);case 1:return a=p.sent(),a?[4,this.initializeNetworkObservers()]:[2];case 2:p.sent(),(n=this.networkObservers)===null||n===void 0||n.start(function(I){v.addCustomRRWebEvent(ae.FETCH_REQUEST,I)}),l=o.privacyConfig,u=o.interactionConfig,m=o.loggingConfig,d=u!=null&&u.enabled?{mouseInteraction:this.eventsManager&&Wn(this.loggerProvider,{eventsManager:this.eventsManager,sessionId:c,deviceIdFn:this.getDeviceId.bind(this),mirror:a.mirror,ugcFilterRules:(i=u.ugcFilterRules)!==null&&i!==void 0?i:[]}),scroll:this.scrollHook}:{},f=u!=null&&u.enabled&&u.ugcFilterRules?u.ugcFilterRules:[],this.loggerProvider.log("Session Replay capture beginning for ".concat(c,".")),p.label=3;case 3:return p.trys.push([3,5,,6]),g=this,h=a,P={emit:function(I){if(v.shouldOptOut()){v.loggerProvider.log("Opting session ".concat(c," out of recording due to optOut config.")),v.stopRecordingEvents(),v.sendEvents();return}I.type===Gt.Meta&&(I.data.href=nt(I.data.href,f)),v.eventCompressor&&v.eventCompressor.enqueueEvent(I,c)},inlineStylesheet:o.shouldInlineStylesheet,hooks:d,maskAllInputs:!0,maskTextClass:At,blockClass:vr,blockSelector:this.getBlockSelectors(),applyBackgroundColorToBlockedElements:o.applyBackgroundColorToBlockedElements,maskInputFn:dt("input",l),maskTextFn:dt("text",l),maskTextSelector:this.getMaskTextSelectors(),recordCanvas:!1,errorHandler:function(I){var E=I;if(E.message.includes("insertRule")&&E.message.includes("CSSStyleSheet")||E._external_)throw E;return v.loggerProvider.warn("Error while capturing replay: ",E.toString()),!0}},[4,this.getRecordingPlugins(m)];case 4:return g.recordCancelCallback=h.apply(void 0,[(P.plugins=p.sent(),P)]),this.addCustomRRWebEvent(ae.DEBUG_INFO),e&&this.addCustomRRWebEvent(ae.METADATA,this.metadata),[3,6];case 5:return b=p.sent(),this.loggerProvider.warn("Failed to initialize session replay:",b),[3,6];case 6:return[2]}})})},t.prototype.getDeviceId=function(){var e;return(e=this.identifiers)===null||e===void 0?void 0:e.deviceId},t.prototype.getSessionId=function(){var e;return(e=this.identifiers)===null||e===void 0?void 0:e.sessionId},t.prototype.flush=function(e){var r;return e===void 0&&(e=!1),C(this,void 0,void 0,function(){return w(this,function(n){return[2,(r=this.eventsManager)===null||r===void 0?void 0:r.flush(e)]})})},t.prototype.shutdown=function(){this.teardownEventListeners(!0),this.stopRecordingEvents(),this.sendEvents()},t.prototype.mapSDKType=function(e){return e==="plugin"?"@amplitude/plugin-session-replay-browser":e==="segment"?"@amplitude/segment-session-replay-plugin":null},t.prototype.setMetadata=function(e,r,n,i,o,s,c){var a=e!=null&&e.toString()?je(e.toString()):void 0;this.metadata={joinedConfig:r,localConfig:n,remoteConfig:i,sessionId:e,hashValue:a,sampleRate:r.sampleRate,replaySDKType:this.mapSDKType(c),replaySDKVersion:o,standaloneSDKType:"@amplitude/session-replay-browser",standaloneSDKVersion:s}},t.prototype.initializeNetworkObservers=function(){var e,r,n;return C(this,void 0,void 0,function(){var i,o;return w(this,function(s){switch(s.label){case 0:if(!(!((n=(r=(e=this.config)===null||e===void 0?void 0:e.loggingConfig)===null||r===void 0?void 0:r.network)===null||n===void 0)&&n.enabled&&!this.networkObservers))return[3,4];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,Oe(()=>import("./observers-DByOVZnt.js"),__vite__mapDeps([0,1,2,3,4,5]))];case 2:return i=s.sent().NetworkObservers,this.networkObservers=new i,[3,4];case 3:return o=s.sent(),this.loggerProvider.warn("Failed to import or instantiate NetworkObservers:",o),[3,4];case 4:return[2]}})})},t}(),he=function(t){return function(){var e=t.config,r=e||Kt(),n=r.loggerProvider,i=r.logLevel;return{logger:n,logLevel:i}}},li=function(){var t=new ui;return{init:fe(t.init.bind(t),"init",he(t)),setSessionId:fe(t.setSessionId.bind(t),"setSessionId",he(t)),getSessionId:fe(t.getSessionId.bind(t),"getSessionId",he(t)),getSessionReplayProperties:fe(t.getSessionReplayProperties.bind(t),"getSessionReplayProperties",he(t)),flush:fe(t.flush.bind(t),"flush",he(t)),shutdown:fe(t.shutdown.bind(t),"shutdown",he(t))}};const ge=li();var di=ge.init,fi=ge.setSessionId,vi=ge.getSessionId,hi=ge.getSessionReplayProperties,gi=ge.flush,pi=ge.shutdown,Ot="1.19.2",mi=function(){function t(e){this.name=t.pluginName,this.type="enrichment",this.sessionReplay={flush:gi,getSessionId:vi,getSessionReplayProperties:hi,init:di,setSessionId:fi,shutdown:pi},this.options=_({forceSessionTracking:!1},e),this.srInitOptions=this.options}return t.prototype.setup=function(e,r){var n,i,o,s,c;return C(this,void 0,void 0,function(){var a;return w(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),e==null||e.loggerProvider.log("Installing @amplitude/plugin-session-replay, version ".concat(Ot,".")),this.config=e,this.options.forceSessionTracking&&(typeof e.defaultTracking=="boolean"?e.defaultTracking===!1&&(e.defaultTracking={pageViews:!1,formInteractions:!1,fileDownloads:!1,sessions:!0}):e.defaultTracking=_(_({},e.defaultTracking),{sessions:!0})),this.srInitOptions={instanceName:this.config.instanceName,deviceId:(n=this.options.deviceId)!==null&&n!==void 0?n:this.config.deviceId,optOut:this.config.optOut,sessionId:this.options.customSessionId?void 0:this.config.sessionId,loggerProvider:this.config.loggerProvider,logLevel:this.config.logLevel,flushMaxRetries:this.config.flushMaxRetries,serverZone:this.config.serverZone,configServerUrl:this.options.configServerUrl,trackServerUrl:this.options.trackServerUrl,sampleRate:this.options.sampleRate,privacyConfig:{blockSelector:(i=this.options.privacyConfig)===null||i===void 0?void 0:i.blockSelector,maskSelector:(o=this.options.privacyConfig)===null||o===void 0?void 0:o.maskSelector,unmaskSelector:(s=this.options.privacyConfig)===null||s===void 0?void 0:s.unmaskSelector,defaultMaskLevel:(c=this.options.privacyConfig)===null||c===void 0?void 0:c.defaultMaskLevel},debugMode:this.options.debugMode,shouldInlineStylesheet:this.options.shouldInlineStylesheet,version:{type:"plugin",version:Ot},performanceConfig:this.options.performanceConfig,storeType:this.options.storeType,experimental:this.options.experimental,applyBackgroundColorToBlockedElements:this.options.applyBackgroundColorToBlockedElements,interactionConfig:this.options.interactionConfig},[4,this.sessionReplay.init(e.apiKey,this.srInitOptions).promise];case 1:return l.sent(),[3,3];case 2:return a=l.sent(),e==null||e.loggerProvider.error("Session Replay: Failed to initialize due to ".concat(a.message)),[3,3];case 3:return[2]}})})},t.prototype.onSessionIdChanged=function(e){return C(this,void 0,void 0,function(){return w(this,function(r){switch(r.label){case 0:return this.config.loggerProvider.debug("Analytics session id is changed to ".concat(e,", SR session id is ").concat(String(this.sessionReplay.getSessionId()),".")),[4,this.sessionReplay.setSessionId(e).promise];case 1:return r.sent(),[2]}})})},t.prototype.onOptOutChanged=function(e){return C(this,void 0,void 0,function(){return w(this,function(r){switch(r.label){case 0:return this.config.loggerProvider.debug("optOut is changed to ".concat(String(e),", calling ").concat(e?"sessionReplay.shutdown()":"sessionReplay.init()",".")),e?(this.sessionReplay.shutdown(),[3,3]):[3,1];case 1:return[4,this.sessionReplay.init(this.config.apiKey,this.srInitOptions).promise];case 2:r.sent(),r.label=3;case 3:return[2]}})})},t.prototype.execute=function(e){var r;return C(this,void 0,void 0,function(){var n,i,n,i,o;return w(this,function(s){switch(s.label){case 0:return s.trys.push([0,8,,9]),this.options.customSessionId?(n=this.options.customSessionId(e),n?n===this.sessionReplay.getSessionId()?[3,2]:[4,this.sessionReplay.setSessionId(n).promise]:[3,3]):[3,4];case 1:s.sent(),s.label=2;case 2:i=this.sessionReplay.getSessionReplayProperties(),e.event_properties=_(_({},e.event_properties),i),s.label=3;case 3:return[3,7];case 4:return n=this.config.sessionId,n&&n!==this.sessionReplay.getSessionId()?[4,this.sessionReplay.setSessionId(n).promise]:[3,6];case 5:s.sent(),s.label=6;case 6:n&&n===e.session_id&&(i=this.sessionReplay.getSessionReplayProperties(),e.event_properties=_(_({},e.event_properties),i)),s.label=7;case 7:return[2,Promise.resolve(e)];case 8:return o=s.sent(),(r=this.config)===null||r===void 0||r.loggerProvider.error("Session Replay: Failed to enrich event due to ".concat(o.message)),[2,Promise.resolve(e)];case 9:return[2]}})})},t.prototype.teardown=function(){var e;return C(this,void 0,void 0,function(){return w(this,function(r){try{this.sessionReplay.shutdown(),this.config=null}catch(n){(e=this.config)===null||e===void 0||e.loggerProvider.error("Session Replay: teardown failed due to ".concat(n.message))}return[2]})})},t.prototype.getSessionReplayProperties=function(){return this.sessionReplay.getSessionReplayProperties()},t.pluginName="@amplitude/plugin-session-replay-browser",t}(),Ii=function(t){return new mi(t)};export{mi as SessionReplayPlugin,Ii as plugin,Ii as sessionReplayPlugin};
